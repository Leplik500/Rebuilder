# ReBuilder - Монорепозиторий микросервисов

## 1. О проекте

**ReBuilder** — это система, состоящая из нескольких микросервисов, разработанных для управления тренировками и пользовательскими данными в рамках фитнес-платформы. Этот монорепозиторий содержит исходный код для всех микросервисов, обеспечивая единое место для разработки, тестирования и деплоя. Основные цели проекта:
- Обеспечение модульной архитектуры для управления различными аспектами фитнес-платформы.
- Упрощение разработки и интеграции между микросервисами.
- Предоставление удобного API для взаимодействия с системой.

В данный момент репозиторий включает два основных микросервиса:
- **User Service**: Управление пользователями, аутентификация и авторизация.
- **Public Workout Service**: Управление публичными тренировками, включая просмотр, лайки, копирование и комментирование.

## 2. Микросервисы

### 2.1 User Service

#### Назначение
**User Service** — это микросервис, отвечающий за управление пользователями системы. Его основные функции включают:
- Регистрацию и аутентификацию пользователей через OTP (одноразовые пароли) и JWT-токены.
- Управление профилями и настройками пользователей.
- Обеспечение авторизации для доступа к другим микросервисам.

#### Технологии и фреймворки
- **.NET Core**: Основной фреймворк для разработки микросервиса.
- **Entity Framework Core**: Для работы с базой данных.
- **Swashbuckle.AspNetCore**: Для генерации Swagger-документации API.
- **Serilog**: Для логирования событий и ошибок.

#### Взаимодействие с другими микросервисами
- **Public Workout Service**: Предоставляет данные о пользователях (например, авторах тренировок) и проверяет права доступа через JWT-токены.

#### Основные эндпоинты
- **POST /auth/request-otp**: Отправка одноразового пароля (OTP) на указанный email для аутентификации.
- **POST /auth/verify-otp**: Проверка OTP и получение JWT-токена для доступа.
- **POST /auth/refresh**: Обновление JWT-токена с использованием refresh-токена.
- **POST /auth/logout**: Отзыв refresh-токена для выхода из системы.
- **POST /auth/register**: Регистрация нового пользователя.
- **GET /api/user/profile**: Получение профиля текущего аутентифицированного пользователя.
- **PATCH /api/user/profile**: Обновление профиля текущего пользователя.
- **GET /api/user/settings**: Получение настроек текущего пользователя.
- **PATCH /api/user/settings**: Обновление настроек текущего пользователя.

Полный список эндпоинтов и их описание доступны в Swagger UI.

#### Способы запуска
- **Запуск через .NET CLI**:

  Запуск напрямую из корневой директории проекта.

#### API документация
- **Swagger UI**: Доступно по пути `/swagger` после запуска сервиса локально или на сервере. Например, `http://localhost:8000/swagger`.

### 2.2 Public Workout Service

#### Назначение
**Public Workout Service** — это микросервис для управления публичными тренировками в рамках системы ReBuilder. Его роль заключается в предоставлении каталога тренировок, доступных для общего просмотра, а также в поддержке функций лайков, копирования тренировок в личный каталог пользователей и комментирования. Основные функции включают:
- Просмотр списка публичных тренировок с фильтрацией и сортировкой.
- Детальный просмотр тренировок, включая упражнения.
- Возможность лайкать, копировать и комментировать тренировки.
- Синхронизация приватных тренировок в публичный каталог.

#### Технологии и фреймворки
- **.NET Core**: Основной фреймворк для разработки микросервиса.
- **Entity Framework Core**: Используется для работы с базой данных через пользовательский паттерн репозитория.
- **Swashbuckle.AspNetCore**: Для генерации Swagger-документации API.
- **Serilog**: Для логирования событий и ошибок.

#### Взаимодействие с другими микросервисами
- **Private Workout Service**: Взаимодействие для синхронизации приватных тренировок в публичный каталог через API (например, эндпоинт `/public/workouts/sync`).
- **User Service**: Взаимодействие для получения информации о пользователях (авторах тренировок, комментариев) и проверки прав доступа через JWT-токены.

#### Основные эндпоинты
- **GET /public/workouts**: Получение списка публичных тренировок с фильтрацией по типу, длительности и сортировкой по лайкам или копиям.
- **GET /public/workouts/{id}**: Получение детальной информации о конкретной публичной тренировке, включая упражнения.
- **POST /public/workouts/sync**: Синхронизация приватной тренировки в публичный каталог (требуется аутентификация).
- **POST /public/workouts/{id}/like**: Лайкнуть тренировку (требуется аутентификация).
- **DELETE /public/workouts/{id}/like**: Убрать лайк с тренировки (требуется аутентификация).
- **POST /public/workouts/{id}/copy**: Скопировать тренировку в личный каталог (требуется аутентификация).
- **GET /public/workouts/{id}/copies**: Получение списка пользователей, скопировавших тренировку (только для владельца, требуется аутентификация).
- **GET /public/workouts/{id}/comments**: Получение списка комментариев к тренировке.
- **POST /public/workouts/{id}/comments**: Добавление комментария к тренировке (требуется аутентификация).
- **PATCH /public/workouts/{id}/comments/{commentId}**: Обновление комментария (только для автора, требуется аутентификация).
- **DELETE /public/workouts/{id}/comments/{commentId}**: Удаление комментария (только для автора или модератора, требуется аутентификация).
- **POST /public/comments/{commentId}/like**: Лайкнуть комментарий (требуется аутентификация).
- **DELETE /public/comments/{commentId}/like**: Убрать лайк с комментария (требуется аутентификация).

Полный список эндпоинтов и их описание доступны в Swagger UI.

#### Способы запуска
- **Запуск через .NET CLI**:
  dotnet run --project PublicWorkout.UI.Api

Запуск напрямую из корневой директории проекта.

#### API документация
- **Swagger UI**: Доступно по пути `/swagger` после запуска сервиса локально или на сервере. Например, `http://localhost:8001/swagger`.

## 3. Архитектура и зависимости

### Общая архитектура
ReBuilder использует микросервисную архитектуру, где каждый сервис отвечает за свою предметную область. Микросервисы взаимодействуют через REST API. Все сервисы разрабатываются на .NET Core для обеспечения единообразия технологий.

### Используемые внешние сервисы
- **PostgreSQL**: Используется как основная база данных для хранения информации о пользователях (в User Service) и публичных тренировках (в Public Workout Service). Настройки подключения указаны в `appsettings.json` файлов.
- **SMTP (Gmail)**: Используется для отправки одноразовых паролей (OTP) и других email-уведомлений через User Service. Настройки указаны в `appsettings.json` для User Service.

### Переменные окружения (.env)
Для запуска микросервисов необходимо настроить следующие переменные окружения (на основе `appsettings.json` файлов):

#### User Service
- **ConnectionStrings__DefaultConnection**: Строка подключения к базе данных PostgreSQL для хранения данных пользователей (например, `Server=localhost;Port=5432;User Id=postgres;Password=postgres;Database=rebuilder_users`).
- **EmailSettings__Host**, **EmailSettings__Port**, **EmailSettings__UserName**, **EmailSettings__Password**, **EmailSettings__EnableSsl**, **EmailSettings__FromEmail**, **EmailSettings__FromName**: Настройки для отправки email через SMTP (Gmail).
- **JwtSettings__SecretKey**, **JwtSettings__Issuer**, **JwtSettings__AccessTokenExpirationMinutes**, **JwtSettings__RefreshTokenExpirationDays**: Настройки для генерации и проверки JWT-токенов.

#### Public Workout Service
- **ConnectionStrings__DefaultConnection**: Строка подключения к базе данных PostgreSQL для хранения данных публичных тренировок (например, `Server=localhost;Port=5432;User Id=postgres;Password=postgres;Database=rebuilder_public_workouts`).

Эти настройки можно переопределить через переменные окружения или файлы `appsettings.<Environment>.json` для различных окружений (Development, Local, Production).

## 4. Как тестировать

### Команды для запуска тестов
dotnet test

Запускает все юнит-тесты в проекте. Тесты покрывают основные сценарии работы с API для каждого микросервиса.

## 5. Контакты и поддержка

- **Автор**: Leplik500 (GitHub: https://github.com/Leplik500)
- **Поддержка**: Связаться можно через GitHub Issues в репозитории проекта (https://github.com/Leplik500/ReBuilder/issues) или через личные сообщения.
-
